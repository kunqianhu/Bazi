<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>生辰八字计算器</title>
<style>
    body { font-family: "STKaiti", "KaiTi", serif; background-color: #faf5e4; padding: 20px; color: #333; }
    h1 { text-align: center; color: #8b0000; }
    .input-section { background: #fffaf0; border: 1px solid #ddd; padding: 15px; border-radius: 8px; max-width: 400px; margin: auto; }
    label { display: block; margin-top: 10px; }
    select { width: 100%; padding: 5px; margin-top: 5px; }
    button { width: 100%; margin-top: 15px; padding: 10px; background: #b8860b; color: white; border: none; font-size: 16px; cursor: pointer; border-radius: 5px; }
    button:hover { background: #daa520; }
    .result { margin-top: 20px; text-align: center; }
    table { margin: auto; border-collapse: collapse; margin-top: 10px; }
    table, th, td { border: 1px solid #999; padding: 8px 12px; }
    .wood { color: green; }
    .fire { color: red; }
    .earth { color: #b8860b; }
    .metal { color: gray; }
    .water { color: blue; }
    .note { margin-top: 10px; font-size: 14px; text-align: center; }
</style>
<script>
// 天干与地支
const gan = ["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"];
const zhi = ["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"];
// 五行颜色映射
const wuxingColor = {
    "甲":"wood","乙":"wood","寅":"wood","卯":"wood",
    "丙":"fire","丁":"fire","巳":"fire","午":"fire",
    "戊":"earth","己":"earth","辰":"earth","戌":"earth","丑":"earth","未":"earth",
    "庚":"metal","辛":"metal","申":"metal","酉":"metal",
    "壬":"water","癸":"water","子":"water","亥":"water"
};
// 八字时辰表
const hourList = [
    {label:"23:00-0:59 子时", start:23, end:0, index:0},
    {label:"1:00-2:59 丑时", start:1, end:2, index:1},
    {label:"3:00-4:59 寅时", start:3, end:4, index:2},
    {label:"5:00-6:59 卯时", start:5, end:6, index:3},
    {label:"7:00-8:59 辰时", start:7, end:8, index:4},
    {label:"9:00-10:59 巳时", start:9, end:10, index:5},
    {label:"11:00-12:59 午时", start:11, end:12, index:6},
    {label:"13:00-14:59 未时", start:13, end:14, index:7},
    {label:"15:00-16:59 申时", start:15, end:16, index:8},
    {label:"17:00-18:59 酉时", start:17, end:18, index:9},
    {label:"19:00-20:59 戌时", start:19, end:20, index:10},
    {label:"21:00-22:59 亥时", start:21, end:22, index:11}
];

// 计算干支序号（0-59）
function getGanZhiIndex(year, month, day) {
    let baseDate = new Date(1984, 1, 2); // 1984-02-02 干支甲子日
    let targetDate = new Date(year, month-1, day);
    let diffDays = Math.floor((targetDate - baseDate) / (24*60*60*1000));
    return (diffDays % 60 + 60) % 60;
}

// 公历 → 四柱
function calcBazi(y, m, d, hourObj) {
    let dayIndex = getGanZhiIndex(y, m, d);

    // 子时跨日处理
    if(hourObj.start === 23){
        dayIndex += 1;
    }

    // 年柱（简化版，不加节气判断）
    let yearIndex = (y - 1984 + 60) % 60;
    let yearGan = gan[yearIndex % 10];
    let yearZhi = zhi[yearIndex % 12];

    // 月柱（简化版）
    let monthGan = gan[(yearIndex*2 + m) % 10];
    let monthZhi = zhi[(m+1) % 12];

    // 日柱
    let dayGan = gan[dayIndex % 10];
    let dayZhi = zhi[dayIndex % 12];

    // 时柱
    let hourGan = gan[(dayIndex*2 + hourObj.index) % 10];
    let hourZhi = zhi[hourObj.index];

    return [
        [yearGan, yearZhi],
        [monthGan, monthZhi],
        [dayGan, dayZhi],
        [hourGan, hourZhi]
    ];
}

function showBazi() {
    let y = parseInt(document.getElementById("year").value);
    let m = parseInt(document.getElementById("month").value);
    let d = parseInt(document.getElementById("day").value);
    let hIndex = parseInt(document.getElementById("hour").value);
    let hourObj = hourList[hIndex];

    let bazi = calcBazi(y, m, d, hourObj);

    let html = "<tr>";
    bazi.forEach(pillar => {
        pillar.forEach(char => {
            html += `<td class="${wuxingColor[char] || ''}">${char}</td>`;
        });
    });
    html += "</tr>";
    document.getElementById("result-table").innerHTML = html;
    document.getElementById("result-section").style.display = "block";
}

// 页面加载生成下拉选项
window.onload = function(){
    let monthSelect = document.getElementById("month");
    let daySelect = document.getElementById("day");
    let hourSelect = document.getElementById("hour");

    for(let i=1;i<=12;i++){
        let opt = document.createElement("option");
        opt.value = i;
        opt.text = i;
        monthSelect.appendChild(opt);
    }
    for(let i=1;i<=31;i++){
        let opt = document.createElement("option");
        opt.value = i;
        opt.text = i;
        daySelect.appendChild(opt);
    }
    hourList.forEach((h,i)=>{
        let opt = document.createElement("option");
        opt.value = i;
        opt.text = h.label;
        hourSelect.appendChild(opt);
    });
}
</script>
</head>
<body>

<h1>请输入您的生辰</h1>
<div class="input-section">
    <label>年：</label>
    <input type="number" id="year" placeholder="例如：1984" value="1984">
    <label>月：</label>
    <select id="month"></select>
    <label>日：</label>
    <select id="day"></select>
    <label>时辰：</label>
    <select id="hour"></select>
    <button onclick="showBazi()">生成八字</button>
</div>

<div id="result-section" class="result" style="display:none;">
    <h3>四柱八字</h3>
    <table>
        <tr>
            <th>年干</th><th>年支</th>
            <th>月干</th><th>月支</th>
            <th>日干</th><th>日支</th>
            <th>时干</th><th>时支</th>
        </tr>
        <tbody id="result-table"></tbody>
    </table>
    <div class="note">
        颜色注解：
        <span class="wood">绿色=木</span>，
        <span class="fire">红色=火</span>，
        <span class="earth">棕黄色=土</span>，
        <span class="metal">灰色=金</span>，
        <span class="water">蓝色=水</span>
    </div>
</div>

</body>
</html>
